<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Ogre三维框架基础篇（二） | cpacm</title><meta name="description" content="Ogre三维框架基础篇 —— 地形，天空和雾"><meta name="keywords" content="ogre"><meta name="author" content="cpacm,348515494@qq.com"><meta name="copyright" content="cpacm"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://www.cpacm.net/2015/02/09/Ogre三维框架基础篇（二）/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Ogre三维框架基础篇（二）"><meta name="twitter:description" content="Ogre三维框架基础篇 —— 地形，天空和雾"><meta name="twitter:image" content="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><meta property="og:type" content="article"><meta property="og:title" content="Ogre三维框架基础篇（二）"><meta property="og:url" content="http://www.cpacm.net/2015/02/09/Ogre三维框架基础篇（二）/"><meta property="og:site_name" content="cpacm"><meta property="og:description" content="Ogre三维框架基础篇 —— 地形，天空和雾"><meta property="og:image" content="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Ogre三维框架基础篇（三）" href="http://www.cpacm.net/2015/02/13/Ogre三维框架基础篇（三）/"><link rel="next" title="Ogre三维框架基础篇（一）" href="http://www.cpacm.net/2015/02/08/Ogre三维框架基础篇（一）/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-143443034-1', 'auto');
ga('send', 'pageview');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"http://cpacm.net/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ogre地形"><span class="toc-number">1.</span> <span class="toc-text">Ogre地形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置摄像机和光源"><span class="toc-number">1.1.</span> <span class="toc-text">设置摄像机和光源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置地形"><span class="toc-number">1.2.</span> <span class="toc-text">设置地形</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#引入相关的附加文件"><span class="toc-number">1.2.1.</span> <span class="toc-text">引入相关的附加文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加函数和成员变量"><span class="toc-number">1.2.2.</span> <span class="toc-text">添加函数和成员变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#地形的配置"><span class="toc-number">1.2.3.</span> <span class="toc-text">地形的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#configureTerrainDefaults函数实现"><span class="toc-number">1.2.4.</span> <span class="toc-text">configureTerrainDefaults函数实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defineTerrain函数实现"><span class="toc-number">1.2.5.</span> <span class="toc-text">defineTerrain函数实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getTerrainImage函数实现"><span class="toc-number">1.2.6.</span> <span class="toc-text">getTerrainImage函数实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#initBlendMaps函数的实现"><span class="toc-number">1.2.7.</span> <span class="toc-text">initBlendMaps函数的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行结果"><span class="toc-number">1.2.8.</span> <span class="toc-text">运行结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#天空"><span class="toc-number">2.</span> <span class="toc-text">天空</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SkyBoxs——天空盒子"><span class="toc-number">2.1.</span> <span class="toc-text">SkyBoxs——天空盒子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SkyDomes——天空穹"><span class="toc-number">2.2.</span> <span class="toc-text">SkyDomes——天空穹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SkyPlanes——天空面"><span class="toc-number">2.3.</span> <span class="toc-text">SkyPlanes——天空面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#雾"><span class="toc-number">3.</span> <span class="toc-text">雾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#雾的类型"><span class="toc-number">3.1.</span> <span class="toc-text">雾的类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结语"><span class="toc-number">4.</span> <span class="toc-text">结语</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">cpacm</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/author.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">请不要忘记，那给你带来感动的，名为二次元的理想乡。</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Ogre三维框架基础篇（二）</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2015-02-09<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-10</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/开源-框架/">开源&amp;框架</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.5k</span><span class="post-meta__separator">|</span><span>阅读时长: 13 分钟</span><span class="post-meta__separator">|</span><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="Ogre地形"><a href="#Ogre地形" class="headerlink" title="Ogre地形"></a>Ogre地形</h2><p>在老版本中，我们使用<code>Terrain Scene Manager</code>来渲染场景中的地形。Ogre1.7版本后则将其转移到组件系统中。<a href="http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Ogre+Terrain+System" target="_blank" rel="noopener">Ogre Terrain System</a>有三个组件：Terrain,Paging和Property。其中Paging组件主要用来实现<a href="http://www.ogre3d.org/tikiwiki/tiki-index.php?page=-LOD,&quot;近处细节表现精细，远处的细节粗略&quot;" target="_blank" rel="noopener">LOD</a>技术。<br><strong>Terrain</strong>中主要的两个类：<strong>Terrain</strong>和<strong>TerrainGroup</strong>。每个Terrain代表一小块地域，然后通过TerrainGroup将每一片区域连接起来，并管理哥哥区域间的关系。它们用于LOD（Level of Detail）渲染。  </p>
<h3 id="设置摄像机和光源"><a href="#设置摄像机和光源" class="headerlink" title="设置摄像机和光源"></a>设置摄像机和光源</h3><p>在<code>createScene()</code>方法中设置摄像机<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   mCamera-&gt;setPosition(Ogre::Vector3(<span class="number">1683</span>, <span class="number">50</span>, <span class="number">2116</span>));</span><br><span class="line">mCamera-&gt;lookAt(Ogre::Vector3(<span class="number">1963</span>, <span class="number">50</span>, <span class="number">1660</span>));</span><br><span class="line">mCamera-&gt;setNearClipDistance(<span class="number">0.1</span>);</span><br><span class="line"><span class="comment">//检查当前的渲染系统是否能够无限的渲染远处的场景</span></span><br><span class="line"><span class="keyword">bool</span> infiniteClip =</span><br><span class="line">	mRoot-&gt;getRenderSystem()-&gt;getCapabilities()-&gt;hasCapability(</span><br><span class="line">	Ogre::RSC_INFINITE_FAR_PLANE);</span><br><span class="line"><span class="comment">//若能，则设置远距离裁剪为0（无限制）</span></span><br><span class="line"><span class="keyword">if</span> (infiniteClip)</span><br><span class="line">	mCamera-&gt;setFarClipDistance(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//不能则设置最远距离为50000尺寸</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	mCamera-&gt;setFarClipDistance(<span class="number">50000</span>);</span><br></pre></td></tr></table></figure></p>
<p>继续设置光源<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//环境光</span></span><br><span class="line">	mSceneMgr-&gt;setAmbientLight(Ogre::ColourValue(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>));</span><br><span class="line">	<span class="comment">//光源方向</span></span><br><span class="line">	Ogre::<span class="function">Vector3 <span class="title">lightdir</span><span class="params">(<span class="number">0.55</span>, <span class="number">-0.3</span>, <span class="number">0.75</span>)</span></span>;</span><br><span class="line">	<span class="comment">//单位向量化</span></span><br><span class="line">	lightdir.normalise();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置光源为平行光，漫反射为白色光</span></span><br><span class="line">	Ogre::Light* light = mSceneMgr-&gt;createLight(<span class="string">"TestLight"</span>);</span><br><span class="line">	light-&gt;setType(Ogre::Light::LT_DIRECTIONAL);</span><br><span class="line">	light-&gt;setDirection(lightdir);</span><br><span class="line">	light-&gt;setDiffuseColour(Ogre::ColourValue::White);</span><br><span class="line">	light-&gt;setSpecularColour(Ogre::ColourValue(<span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>));</span><br></pre></td></tr></table></figure></p>
<h3 id="设置地形"><a href="#设置地形" class="headerlink" title="设置地形"></a>设置地形</h3><h4 id="引入相关的附加文件"><a href="#引入相关的附加文件" class="headerlink" title="引入相关的附加文件"></a>引入相关的附加文件</h4><p>在设置地形前先引入相关的附加文件。“项目——属性——配置属性——链接器——输入”，在“附加依赖项”处添加属性页中附加OgreTerrain_d.lib。<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_terrain_set.png" alt="添加依赖项"></p>
<h4 id="添加函数和成员变量"><a href="#添加函数和成员变量" class="headerlink" title="添加函数和成员变量"></a>添加函数和成员变量</h4><p><strong>TutorialApplication</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __TutorialApplication_h_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __TutorialApplication_h_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Terrain/OgreTerrain.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Terrain/OgreTerrainGroup.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"BaseApplication.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TutorialApplication</span> :</span> <span class="keyword">public</span> BaseApplication</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	TutorialApplication(<span class="keyword">void</span>);</span><br><span class="line">	<span class="keyword">virtual</span> ~TutorialApplication(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">createScene</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">createFrameListener</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">destroyScene</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">frameRenderingQueued</span><span class="params">(<span class="keyword">const</span> Ogre::FrameEvent&amp; fe)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">defineTerrain</span><span class="params">(<span class="keyword">long</span> x, <span class="keyword">long</span> y)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initBlendMaps</span><span class="params">(Ogre::Terrain* terrain)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">configureTerrainDefaults</span><span class="params">(Ogre::Light* light)</span></span>;</span><br><span class="line"></span><br><span class="line">	OgreBites::Label* mInfoLabel;</span><br><span class="line">	<span class="keyword">bool</span> mTerrainsImported;</span><br><span class="line">	Ogre::TerrainGroup* mTerrainGroup;</span><br><span class="line">	Ogre::TerrainGlobalOptions* mTerrainGlobals;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>TutorialApplication.cpp</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"TutorialApplication.h"</span></span></span><br><span class="line"> </span><br><span class="line">TutorialApplication::TutorialApplication()</span><br><span class="line">  : mTerrainGroup(<span class="number">0</span>),</span><br><span class="line">    mTerrainGlobals(<span class="number">0</span>),</span><br><span class="line">    mInfoLabel(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">TutorialApplication::~TutorialApplication()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::createScene()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::createFrameListener()</span><br><span class="line">&#123;</span><br><span class="line">  BaseApplication::createFrameListener();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::destroyScene()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">bool</span> TutorialApplication::frameRenderingQueued(<span class="keyword">const</span> Ogre::FrameEvent&amp; fe)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">bool</span> ret = BaseApplication::frameRenderingQueued(fe);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getTerrainImage</span><span class="params">(<span class="keyword">bool</span> flipX, <span class="keyword">bool</span> flipY, Ogre::Image&amp; img)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::defineTerrain(<span class="keyword">long</span> x, <span class="keyword">long</span> y)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::initBlendMaps(Ogre::Terrain* terrain)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> TutorialApplication::configureTerrainDefaults(Ogre::Light* light)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="地形的配置"><a href="#地形的配置" class="headerlink" title="地形的配置"></a>地形的配置</h4><p>在<code>createScene</code>方法中，继续加入。<br>1、获取地形配置属性类<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置地形属性</span></span><br><span class="line"><span class="comment">// OGRE_NEW 是一个专属于Ogre的宏定义</span></span><br><span class="line"><span class="comment">//TerrainGlobalOptions属于OgreTerrain中的一个类，用于配置地形的属性。</span></span><br><span class="line">mTerrainGlobals = OGRE_NEW Ogre::TerrainGlobalOptions();</span><br></pre></td></tr></table></figure></p>
<p>2、设置地形组<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置地形组</span></span><br><span class="line"><span class="comment">//参数分别为场景管理器，terrain的朝向（铺面x,z轴），terrain的大小，整个Group的大小</span></span><br><span class="line">mTerrainGroup = OGRE_NEW Ogre::TerrainGroup(</span><br><span class="line">	mSceneMgr, </span><br><span class="line">	Ogre::Terrain::ALIGN_X_Z, </span><br><span class="line">	<span class="number">513</span>, <span class="number">12000.0</span>);</span><br><span class="line"><span class="comment">//设置保存名字为“terrain.dat”</span></span><br><span class="line">mTerrainGroup-&gt;setFilenameConvention(Ogre::String(<span class="string">"terrain"</span>), Ogre::String(<span class="string">"dat"</span>));</span><br><span class="line"><span class="comment">//设置中心点为原点</span></span><br><span class="line">mTerrainGroup-&gt;setOrigin(Ogre::Vector3::ZERO);</span><br></pre></td></tr></table></figure></p>
<p>3、配置地形的一些参数<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Terrain配置方法</span></span><br><span class="line">configureTerrainDefaults(light);</span><br></pre></td></tr></table></figure></p>
<p>4、让TerrainGroup读取所有的Terrain图<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让TerrainGroup读取所有的Terrain图</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">long</span> x = <span class="number">0</span>; x &lt;= <span class="number">0</span>; ++x)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">long</span> y = <span class="number">0</span>; y &lt;= <span class="number">0</span>; ++y)</span><br><span class="line">			defineTerrain(x, y);</span><br><span class="line"></span><br><span class="line">	mTerrainGroup-&gt;loadAllTerrains(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>4、导入配置完成的地形<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入我们的地形</span></span><br><span class="line">	<span class="keyword">if</span> (mTerrainsImported)</span><br><span class="line">	&#123;</span><br><span class="line">		Ogre::TerrainGroup::TerrainIterator ti = mTerrainGroup-&gt;getTerrainIterator();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (ti.hasMoreElements())</span><br><span class="line">		&#123;</span><br><span class="line">			Ogre::Terrain* t = ti.getNext()-&gt;instance;</span><br><span class="line">			initBlendMaps(t);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>5、清除操作<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//保存地形数据到磁盘中</span></span><br><span class="line">mTerrainGroup-&gt;saveAllTerrains(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//地形建成后，清除一些内存</span></span><br><span class="line">mTerrainGroup-&gt;freeTemporaryResources();</span><br></pre></td></tr></table></figure></p>
<h4 id="configureTerrainDefaults函数实现"><a href="#configureTerrainDefaults函数实现" class="headerlink" title="configureTerrainDefaults函数实现"></a><strong>configureTerrainDefaults</strong>函数实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> TutorialApplication::configureTerrainDefaults(Ogre::Light* light)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//MaxPixelError决定了地形的精度，这个值越小地形越精确，当然效率就越低</span></span><br><span class="line">	mTerrainGlobals-&gt;setMaxPixelError(<span class="number">8</span>);</span><br><span class="line">	<span class="comment">//设置在多远处开始使用组合贴图。在摄像机周围3000范围内看到地形，而之外则是我们定义的光影颜色</span></span><br><span class="line">	mTerrainGlobals-&gt;setCompositeMapDistance(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在地形的渲染中，Ogre提供了一种组合贴图的渲染，就是在较远的地方使用一种贴图混合简单光影的方式来代替实际的纹理.</span></span><br><span class="line">	<span class="comment">//设置产生组合贴图的光线方向</span></span><br><span class="line">	mTerrainGlobals-&gt;setLightMapDirection(light-&gt;getDerivedDirection());</span><br><span class="line">	<span class="comment">//设置组合贴图的光影颜色</span></span><br><span class="line">	mTerrainGlobals-&gt;setCompositeMapAmbient(mSceneMgr-&gt;getAmbientLight());</span><br><span class="line">	mTerrainGlobals-&gt;setCompositeMapDiffuse(light-&gt;getDiffuseColour());</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置地形的一些属性</span></span><br><span class="line">	<span class="comment">//terrainSize指的是地形大小(必须是2^n+1)，maxBatchSize指的是最大的批次大小(必须是2^n+1，并且小于等于65)，worldSize指的是地形的世界大小等等</span></span><br><span class="line">	<span class="comment">//inputScale是对导入数据（高度图）的高度值的缩放,值越大表示越陡峭</span></span><br><span class="line">	Ogre::Terrain::ImportData&amp; importData = mTerrainGroup-&gt;getDefaultImportSettings();</span><br><span class="line">	importData.terrainSize = <span class="number">513</span>;</span><br><span class="line">	importData.worldSize = <span class="number">12000.0</span>;</span><br><span class="line">	importData.inputScale = <span class="number">600</span>;</span><br><span class="line">	importData.minBatchSize = <span class="number">33</span>;</span><br><span class="line">	importData.maxBatchSize = <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//它允许地形上有几个纹理层次（数目取决于你的硬件），标记为0层，1层……n层，默认情况下你只能见到第0层，我们可以设置n+1层对之前n层纹理的混合结果的混合方式，如果不混合就只能看到第0层。</span></span><br><span class="line">	<span class="comment">//首先你要定义这些层的纹理是什么及纹理的大小。</span></span><br><span class="line">	<span class="comment">//设置有几层纹理</span></span><br><span class="line">	importData.layerList.resize(<span class="number">3</span>);</span><br><span class="line">	<span class="comment">//设置该层纹理的空间大小</span></span><br><span class="line">	importData.layerList[<span class="number">0</span>].worldSize = <span class="number">100</span>;</span><br><span class="line">	<span class="comment">//设置该层纹理的贴图和法向贴图</span></span><br><span class="line">	importData.layerList[<span class="number">0</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"dirt_grayrocky_diffusespecular.dds"</span>);</span><br><span class="line">	importData.layerList[<span class="number">0</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"dirt_grayrocky_normalheight.dds"</span>);</span><br><span class="line"></span><br><span class="line">	importData.layerList[<span class="number">1</span>].worldSize = <span class="number">30</span>;</span><br><span class="line">	importData.layerList[<span class="number">1</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"grass_green-01_diffusespecular.dds"</span>);</span><br><span class="line">	importData.layerList[<span class="number">1</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"grass_green-01_normalheight.dds"</span>);</span><br><span class="line">	importData.layerList[<span class="number">2</span>].worldSize = <span class="number">200</span>;</span><br><span class="line">	importData.layerList[<span class="number">2</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"growth_weirdfungus-03_diffusespecular.dds"</span>);</span><br><span class="line">	importData.layerList[<span class="number">2</span>].textureNames.push_back(</span><br><span class="line">		<span class="string">"growth_weirdfungus-03_normalheight.dds"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="defineTerrain函数实现"><a href="#defineTerrain函数实现" class="headerlink" title="defineTerrain函数实现"></a>defineTerrain函数实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">用来导入高度图</span></span><br><span class="line"><span class="comment">通过TerrainGroup的generateFilename函数生成纹理的名字，然后在我们的资源组中进行检查，看是否已经存在这个地形数据了，</span></span><br><span class="line"><span class="comment">如果已经存在了，就不需要再次从一个图片中导入了，如果不存在我们就需要加载图片使用它去生成我们的地形</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> TutorialApplication::defineTerrain(<span class="keyword">long</span> x, <span class="keyword">long</span> y)</span><br><span class="line">&#123;</span><br><span class="line">	Ogre::String filename = mTerrainGroup-&gt;generateFilename(x, y);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> exists =</span><br><span class="line">		Ogre::ResourceGroupManager::getSingleton().resourceExists(</span><br><span class="line">		mTerrainGroup-&gt;getResourceGroup(),</span><br><span class="line">		filename);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (exists)</span><br><span class="line">		mTerrainGroup-&gt;defineTerrain(x, y);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		Ogre::Image img;</span><br><span class="line">		getTerrainImage(x % <span class="number">2</span> != <span class="number">0</span>, y % <span class="number">2</span> != <span class="number">0</span>, img);</span><br><span class="line">		mTerrainGroup-&gt;defineTerrain(x, y, &amp;img);</span><br><span class="line"></span><br><span class="line">		mTerrainsImported = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="getTerrainImage函数实现"><a href="#getTerrainImage函数实现" class="headerlink" title="getTerrainImage函数实现"></a>getTerrainImage函数实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这个函数就是加载我们前面中提到过的需要加载的图片，这个图片会用来生成对应的地形数据。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getTerrainImage</span><span class="params">(<span class="keyword">bool</span> flipX, <span class="keyword">bool</span> flipY, Ogre::Image&amp; img)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	img.load(<span class="string">"terrain.png"</span>, Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (flipX)</span><br><span class="line">		img.flipAroundY();</span><br><span class="line">	<span class="keyword">if</span> (flipY)</span><br><span class="line">		img.flipAroundX();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="initBlendMaps函数的实现"><a href="#initBlendMaps函数的实现" class="headerlink" title="initBlendMaps函数的实现"></a>initBlendMaps函数的实现</h4><p>在产生了地形实例后，我们需要对地形的纹理层进行我们想要的混合方式，我们可以通过地形组的迭代器访问每一个地形实例，然后把对应的地形实例指针传递给这个函数。混合的原理机制是这样的：对于每一个纹理层，都有一个保存每个像素的alpha混合的值，可以通过Ogre::TerrainLayerBlendMap* blendMap0 =terrain-&gt;getLayerBlendMap(1);这样的方式来获取第1层的这个混合数据，初始情况下都是0，也就是说，默认情况下第1层对第0层的混合是0，那样你就只能看到0层，你可以通过修改这个数据来直接修改混合方式，这就像两张图像做混合，而每张混合图像代表了整个这个地形实例的表面图片，为了得到这个图像的边长，可以使用terrain-&gt;getLayerBlendMapSize();你还可以使用blendMap0-&gt;convertImageToTerrainSpace(x,y, &amp;tx, &amp;ty);来得到混合图像空间上(x,y)的那个像素对应的地形实例空间上的坐标，我们修改了混合值之后，还需要使用blendMap0-&gt;dirty();blendMap0-&gt;update();来更新。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">对地形的纹理层进行混合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> TutorialApplication::initBlendMaps(Ogre::Terrain* terrain)</span><br><span class="line">&#123;</span><br><span class="line">	Ogre::Real minHeight0 = <span class="number">70</span>;</span><br><span class="line">	Ogre::Real fadeDist0 = <span class="number">40</span>;</span><br><span class="line">	Ogre::Real minHeight1 = <span class="number">70</span>;</span><br><span class="line">	Ogre::Real fadeDist1 = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">	Ogre::TerrainLayerBlendMap* blendMap0 = terrain-&gt;getLayerBlendMap(<span class="number">1</span>);</span><br><span class="line">	Ogre::TerrainLayerBlendMap* blendMap1 = terrain-&gt;getLayerBlendMap(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">float</span>* pBlend0 = blendMap0-&gt;getBlendPointer();</span><br><span class="line">	<span class="keyword">float</span>* pBlend1 = blendMap1-&gt;getBlendPointer();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Ogre::uint16 y = <span class="number">0</span>; y &lt; terrain-&gt;getLayerBlendMapSize(); ++y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (Ogre::uint16 x = <span class="number">0</span>; x &lt; terrain-&gt;getLayerBlendMapSize(); ++x)</span><br><span class="line">		&#123;</span><br><span class="line">			Ogre::Real tx, ty;</span><br><span class="line"></span><br><span class="line">			blendMap0-&gt;convertImageToTerrainSpace(x, y, &amp;tx, &amp;ty);</span><br><span class="line">			Ogre::Real height = terrain-&gt;getHeightAtTerrainPosition(tx, ty);</span><br><span class="line">			Ogre::Real val = (height - minHeight0) / fadeDist0;</span><br><span class="line">			val = Ogre::Math::Clamp(val, (Ogre::Real)<span class="number">0</span>, (Ogre::Real)<span class="number">1</span>);</span><br><span class="line">			*pBlend0++ = val;</span><br><span class="line"></span><br><span class="line">			val = (height - minHeight1) / fadeDist1;</span><br><span class="line">			val = Ogre::Math::Clamp(val, (Ogre::Real)<span class="number">0</span>, (Ogre::Real)<span class="number">1</span>);</span><br><span class="line">			*pBlend1++ = val;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	blendMap0-&gt;dirty();</span><br><span class="line">	blendMap1-&gt;dirty();</span><br><span class="line">	blendMap0-&gt;update();</span><br><span class="line">	blendMap1-&gt;update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_Terrain_Result.jpg" alt="Ogre地形"></p>
<h2 id="天空"><a href="#天空" class="headerlink" title="天空"></a>天空</h2><p>Ogre提供了三种类型的天空：天空盒，天空穹和天空面。</p>
<h3 id="SkyBoxs——天空盒子"><a href="#SkyBoxs——天空盒子" class="headerlink" title="SkyBoxs——天空盒子"></a>SkyBoxs——天空盒子</h3><p>天空盒实际上是一个立方体，它包含了场景里所有的对象。将下面代码加入<code>createScene</code>方法中，运行可以看到<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSceneMgr-&gt;setSkyBox(<span class="literal">true</span>, <span class="string">"Examples/SpaceSkyBox"</span>, <span class="number">3000</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_Skybox.jpg" alt="Skybox"><br>skybox函数有4个参数，下面分别介绍这4个参数的作用。</p>
<blockquote>
<p>第一个参数，代表是否启用天空盒。如果我们想要取消天空盒，那么我们只须调用一句代码mSceneMgr-&gt;setSkyBox( false, “” ); 即可。<br>第二个参数，用来设置天空盒使用的材质脚本。<br>第三个参数，用来设定天空盒与摄像机的距离。<br>第四个参数，决定了天空盒是在其他对象之前渲染还是其他对象之后渲染。  </p>
</blockquote>
<h3 id="SkyDomes——天空穹"><a href="#SkyDomes——天空穹" class="headerlink" title="SkyDomes——天空穹"></a>SkyDomes——天空穹</h3><p>天空穹和天空盒非常相似，在Ogre中创建一个天空穹要使用的函数是setSkyDome函数。天空穹也会创建一个包含了场景中所有对象的巨型立方体，但是它与天空盒最大的区别是：天空穹的贴图是用球体的方法投影到立方体上的。所以，天空穹其实还是一个立方体，只不过它的贴图看上去像贴到了一个球体上一样。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSceneMgr-&gt;setSkyDome(<span class="literal">true</span>,<span class="string">"Examples/CloudySky"</span>, <span class="number">5</span>, <span class="number">8</span>);</span><br></pre></td></tr></table></figure></p>
<p>前两个参数跟天空盒一样，第三个参数是天空穹的弯曲程度，OGRE的API中建议使用2到65之间的数值。第四个参数用来设置贴图重复的次数，这个参数需要根据贴图的实际大小来设置，以便让贴图可以适应我们的程序。<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_SkyDome.jpg" alt="SkyDomes"></p>
<h3 id="SkyPlanes——天空面"><a href="#SkyPlanes——天空面" class="headerlink" title="SkyPlanes——天空面"></a>SkyPlanes——天空面</h3><p>天空面与前两种类型的天空（天空盒和天空穹）有很大的区别。天空面使用一个平面来替代立方体，也就是说，我们仅仅把纹理映射到一个简单的面上，而不再映射到一个立方体上。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一个平行于xz轴，高度为1000的平面</span></span><br><span class="line">Ogre::Plane plane;</span><br><span class="line">plane.d = <span class="number">1000</span>;</span><br><span class="line">plane.normal = Ogre::Vector3::NEGATIVE_UNIT_Y;</span><br><span class="line"><span class="comment">//创建天空面</span></span><br><span class="line">mSceneMgr-&gt;setSkyPlane(<span class="literal">true</span>, plane, <span class="string">"Examples/SpaceSkyPlane"</span>, <span class="number">1500</span>, <span class="number">75</span>);</span><br></pre></td></tr></table></figure></p>
<p>第四个参数用来设定天空面的大小，在这里将其设置成为了1500x1500的大小。第五个参数是重复的次数，这里设置的重复次数为75。<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_SkyPlane.jpg" alt="天空面"><br>将创建天空面的代码换成<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSceneMgr-&gt;setSkyPlane(<span class="literal">true</span>, plane, <span class="string">"Examples/SpaceSkyPlane"</span>, <span class="number">1500</span>, <span class="number">55</span>, <span class="literal">true</span>, <span class="number">1.5f</span>, <span class="number">160</span>, <span class="number">160</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_SkyPlane_More.jpg" alt="优化设置的天空面"><br>我们就这一行代码来看一下setSkyPlane这个函数每个参数的作用。</p>
<blockquote>
<ol>
<li>第一个参数用来设置是否启用天空面。如果我们想要取消天空盒，那么我们只须调用一句代码mSceneMgr-&gt;setSkyPlane( false, “” ); 即可。</li>
<li>第三个参数用来设置天空盒使用的材质脚本。</li>
<li>第四个参数用来设置天空面的大小。</li>
<li>第五个参数用来设置天空面重复的次数。</li>
<li>第六个参数用来设置天空面的渲染顺序，它决定了天空面是最先被渲染还是最后被渲染。参数为true表明天空面最先被渲染，参数为false表明天空面最后被渲染。</li>
<li>第七个参数用来设置天空面的弯曲度，这样一来就可以实现将平面弯曲成弧形的效果了。同时我们还需要设置x和y的线段数量，这是因为天空面是一个巨大的正方形，但是假如我们想将它弯曲那么就要将它切分成许多小正方形，以便我们可以实现弯曲的效果。</li>
<li>第八个和第九个参数是x和y的线段数量了。因为天空面是一个大的正方形，若要将其弯曲就必须将其变成许多小的正方形，所以要设置x和y方向上的线段数量。  </li>
</ol>
</blockquote>
<h2 id="雾"><a href="#雾" class="headerlink" title="雾"></a>雾</h2><p>在Ogre中，雾有两种，线性的雾和指数的雾。线性雾随着参数的变化“线性的”增加浓度，而指数雾随着参数的变化“指数的”增加浓度。在场景中设置雾化效果，实际只是添加一个雾的滤镜而已。<br>在设置地形前先设置视口的背景颜色<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置视口的背景颜色</span></span><br><span class="line">Ogre::<span class="function">ColourValue <span class="title">fadeColour</span><span class="params">(<span class="number">0.9</span>, <span class="number">0.9</span>, <span class="number">0.9</span>)</span></span>;</span><br><span class="line">mWindow-&gt;getViewport(<span class="number">0</span>)-&gt;setBackgroundColour(fadeColour);</span><br></pre></td></tr></table></figure></p>
<h3 id="雾的类型"><a href="#雾的类型" class="headerlink" title="雾的类型"></a>雾的类型</h3><p>Tips:代码放在设置地形前<br><strong>线性雾</strong><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置雾的效果,线性雾</span></span><br><span class="line">	mSceneMgr-&gt;setFog(Ogre::FOG_LINEAR, fadeColour, <span class="number">0</span>, <span class="number">60</span>, <span class="number">900</span>);</span><br></pre></td></tr></table></figure></p>
<p>第一个参数用来设置雾的类型，类型有两种：线性的或是指数的。第二个参数用来设置雾的颜色。第三个参数在线性雾里面是不用设置的。第四个和第五个参数是设置雾慢慢变浓的范围。这个慢慢变浓的范围如何理解呢？例如我们这里设置的变浓范围是60到900，这就意味着在摄像机的0到60的单位内是没有雾的，从60到900的单位内雾慢慢线性变浓，在900单位以外就全是雾了。</p>
<p><strong>指数雾之一</strong><br>通过第三个参数“雾的密度”来设置雾的浓度，第四和第五不需要设置<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSceneMgr-&gt;setFog(Ogre::FOG_EXP, fadeColour, <span class="number">0.002</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>指数雾之二</strong><br>这种指数雾，离摄像机越远它的浓度越强<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSceneMgr-&gt;setFog(Ogre::FOG_EXP2, fadeColour, <span class="number">0.002</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre_Fog.jpg" alt="雾"></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>这章学的不轻松，很多三维建模中的知识都不清楚，以后要找机会补习一下三维建模的知识。</p>
<p><embed src="http://www.xiami.com/widget/0_1769955568/singlePlayer.swf" type="application/x-shockwave-flash" width="257" height="33" wmode="transparent"><br>参考文章：<br>1、<a href="http://blog.csdn.net/zhanghua1816/article/details/18195357" target="_blank" rel="noopener">【Ogre编程入门与进阶】第八章 地形、天空与雾化效果</a><br>2、<a href="http://www.ogre3d.org/tikiwiki/tiki-index.php?page=Basic+Tutorial+3&amp;structure=Tutorials" target="_blank" rel="noopener">官方基础教程3</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:348515494@qq.com">cpacm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.cpacm.net/2015/02/09/Ogre三维框架基础篇（二）/">http://www.cpacm.net/2015/02/09/Ogre三维框架基础篇（二）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.cpacm.net">cpacm</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ogre/">ogre    </a></div><div class="post_share"><div class="social-share" data-image="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png" data-sites="facebook,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2015/02/13/Ogre三维框架基础篇（三）/"><img class="prev_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Ogre三维框架基础篇（三）</span></div></a></div><div class="next-post pull-right"><a href="/2015/02/08/Ogre三维框架基础篇（一）/"><img class="next_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Ogre三维框架基础篇（一）</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2015/02/17/Ogre三维框架基础篇（六）/" title="Ogre三维框架基础篇（六）"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><div class="relatedPosts_title">Ogre三维框架基础篇（六）</div></a></div><div class="relatedPosts_item"><a href="/2015/02/15/Ogre三维框架基础篇（四）/" title="Ogre三维框架基础篇（四）"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><div class="relatedPosts_title">Ogre三维框架基础篇（四）</div></a></div><div class="relatedPosts_item"><a href="/2015/02/13/Ogre三维框架基础篇（三）/" title="Ogre三维框架基础篇（三）"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><div class="relatedPosts_title">Ogre三维框架基础篇（三）</div></a></div><div class="relatedPosts_item"><a href="/2015/02/08/Ogre三维框架基础篇（一）/" title="Ogre三维框架基础篇（一）"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><div class="relatedPosts_title">Ogre三维框架基础篇（一）</div></a></div><div class="relatedPosts_item"><a href="/2015/02/08/Ogre三维框架安装篇/" title="Ogre三维框架安装篇"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Ogre3D-Gallery_512.png"><div class="relatedPosts_title">Ogre三维框架安装篇</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '5c29cd4522b265a64d03',
  clientSecret: '01edcfc7cfada89d0092705e0c19a458eceb833f',
  repo: 'https://github.com/cpacm/cpacm.github.io',
  owner: 'cpacm',
  admin: 'cpacm',
  id: md5(decodeURI(location.pathname)),
  language: ''
})
gitalk.render('gitalk-container')</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2019 By cpacm</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">簡</a><i class="fa fa-moon-o nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/local-search.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/js/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>