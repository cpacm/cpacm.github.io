<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Android开发日记（四）——Android四大组件之Broadcast Receiver | cpacm</title><meta name="description" content="广播接受者是作为系统的监听者存在着的，它可以监听系统或系统中其他应用发生的事件来做出响应。如设备开机时，应用要检查数据的变化状况，此时就可以通过广播来把消息通知给用户。又如网络状态改变时，电量变化时都可以通过广播来通知用户。要做比喻的话，广播就像是我们的感官，能够有效且快速的从外界获取信息来反馈给自身。"><meta name="keywords" content="Android,开发系列"><meta name="author" content="cpacm,348515494@qq.com"><meta name="copyright" content="cpacm"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://www.cpacm.net/2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Android开发日记（四）——Android四大组件之Broadcast Receiver"><meta name="twitter:description" content="广播接受者是作为系统的监听者存在着的，它可以监听系统或系统中其他应用发生的事件来做出响应。如设备开机时，应用要检查数据的变化状况，此时就可以通过广播来把消息通知给用户。又如网络状态改变时，电量变化时都可以通过广播来通知用户。要做比喻的话，广播就像是我们的感官，能够有效且快速的从外界获取信息来反馈给自身。"><meta name="twitter:image" content="http://www.cpacm.net/img/author.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Android开发日记（四）——Android四大组件之Broadcast Receiver"><meta property="og:url" content="http://www.cpacm.net/2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/"><meta property="og:site_name" content="cpacm"><meta property="og:description" content="广播接受者是作为系统的监听者存在着的，它可以监听系统或系统中其他应用发生的事件来做出响应。如设备开机时，应用要检查数据的变化状况，此时就可以通过广播来把消息通知给用户。又如网络状态改变时，电量变化时都可以通过广播来通知用户。要做比喻的话，广播就像是我们的感官，能够有效且快速的从外界获取信息来反馈给自身。"><meta property="og:image" content="http://www.cpacm.net/img/author.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Android开发日记（五）——Android数据存储（上）" href="http://www.cpacm.net/2015/03/22/Android开发日记（五）——Android数据存储（上）/"><link rel="next" title="Mina框架的学习笔记——Android客户端的实现" href="http://www.cpacm.net/2015/03/22/Mina框架的学习笔记——Android客户端的实现/"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-143443034-1', 'auto');
ga('send', 'pageview');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"http://cpacm.net/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、广播的功能和特征"><span class="toc-number">1.</span> <span class="toc-text">一、广播的功能和特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、广播事件监听的两种方法"><span class="toc-number">2.</span> <span class="toc-text">二、广播事件监听的两种方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态注册"><span class="toc-number">2.1.</span> <span class="toc-text">静态注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态注册"><span class="toc-number">2.2.</span> <span class="toc-text">动态注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、广播的两种类型"><span class="toc-number">3.</span> <span class="toc-text">三、广播的两种类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#普通广播"><span class="toc-number">3.1.</span> <span class="toc-text">普通广播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有序广播"><span class="toc-number">3.2.</span> <span class="toc-text">有序广播</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、形形色色的广播"><span class="toc-number">4.</span> <span class="toc-text">四、形形色色的广播</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">cpacm</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/author.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">请不要忘记，那给你带来感动的，名为二次元的理想乡。</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Android开发日记（四）——Android四大组件之Broadcast Receiver</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2015-03-22<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-10</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Android/">Android</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.6k</span><span class="post-meta__separator">|</span><span>阅读时长: 14 分钟</span><span class="post-meta__separator">|</span><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p><em>本系列原本写于博客园，现移植到自己的博客上并重新编辑。</em>  </p>
<h2 id="一、广播的功能和特征"><a href="#一、广播的功能和特征" class="headerlink" title="一、广播的功能和特征"></a>一、广播的功能和特征</h2><ol>
<li>广播的生命周期很短，经过 <strong>调用对象—实现onReceive—结束</strong> 整个过程就结束了。从实现的复杂度和代码量来看，广播无疑是最迷你的Android组件，实现往往只需几行代码。广播对象被构造出来后通常只执行<code>BroadcastReceiver.onReceive</code>方法，便结束了其生命周期。所以有的时候我们可以把它当做函数看也未必不可。</li>
<li>和所有组件一样，广播对象也是在应用进程的主线程中被构造，所以广播对象的执行必须是要同步且快速的。也不推荐在里面开子线程，因为往往线程还未结束，广播对象就已经执行完毕被系统销毁。如果需要完成一项比较耗时的工作 , 应该通过发送 Intent 给 Service, 由 Service 来完成。</li>
<li>每次广播到来时,会重新创建 <code>BroadcastReceiver</code> 对象 , 并且调用 <code>onReceive()</code> 方法 , 执行完以后 , 该对象即被销毁 . 当 <code>onReceive()</code> 方法在 10 秒内没有执行完毕， Android 会认为该程序无响应。</li>
</ol>
<h2 id="二、广播事件监听的两种方法"><a href="#二、广播事件监听的两种方法" class="headerlink" title="二、广播事件监听的两种方法"></a>二、广播事件监听的两种方法</h2><p>使用广播进行事件监听有两种方法，静态注册和动态注册，又或者称冷插拔和热插拔。静态注册就是将广播接收器的相关信息写在应用的配置文件中。当有广播事件发生时，组件管理服务就会从安装包管理服务中获取已安装应用的广播组件信息。动态注册则是通过Context.registerReceiver和Context.unregisterRecever，动态将广播接收器与所需要监听的事件绑定。</p>
<h3 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h3><p>首先是在应用的配置文件中写入注册消息，同样是跟其他组件一样写在application标签之内<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".ColdReceiver"</span>&gt;</span><span class="comment">&lt;!-- 你的Receiver名称 --&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.COLD_BROADCAST"</span>/&gt;</span>  <span class="comment">&lt;!-- 你广播要接受的intent名称 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后我们建一个ColdReceiver的类，继承BroadcastReceiver，里面代码如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColdReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//跳转到service中</span></span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//开启service</span></span><br><span class="line">        context.startService(intent);</span><br><span class="line">        <span class="comment">//日志打印</span></span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"静态注册"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中service的配置和内容如下<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=".BroadcastService"&gt;&lt;!-- 你自定义的service文件   （在&lt;application&gt;&lt;/application&gt;里面加）--&gt;</span><br><span class="line">        &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">"android.intent.action.BroadcastService"</span> /&gt;&lt;!-- 用intent启动时的快捷名（也可以用常规的方式启动） --&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">"android.intent.category.default"</span> /&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BroadcastService</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//开启服务时会首先调用该方法</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据每次intent传过来的信息进行判断来显示不同信息</span></span><br><span class="line">        <span class="keyword">switch</span>(intent.getFlags())&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">                Toast.makeText(getApplicationContext(), <span class="string">"静态注册"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">                Toast.makeText(getApplicationContext(), <span class="string">"动态注册"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">                Toast.makeText(getApplicationContext(), <span class="string">"普通广播"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line">                Toast.makeText(getApplicationContext(), <span class="string">"有序广播"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 停止service后会调用此方法</span></span><br><span class="line">        Log.d(<span class="string">"TEST"</span>, <span class="string">"destroy"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>静态广播的创建就此完成，简单的两个步骤，一是配置广播，二是继承BroadcastReceiver，重写里面的onReceive函数。<br>接下来我们再新建一个工程来检测广播是否可以响应消息。（检测应用的代码全部都在下方，并且不用再做更改了）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button b1,b2,b3,b4;</span><br><span class="line">    <span class="keyword">private</span> Intent intent;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        <span class="comment">//获得界面的控件</span></span><br><span class="line">        b1 = (Button) findViewById(R.id.button1);</span><br><span class="line">        b1.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        b2 = (Button) findViewById(R.id.button2);</span><br><span class="line">        b2.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        b3 = (Button) findViewById(R.id.button3);</span><br><span class="line">        b3.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        b4 = (Button) findViewById(R.id.button4);</span><br><span class="line">        b4.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"===初始化完成==="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span>(v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.button1:&#123;<span class="comment">//发送到静态注册广播</span></span><br><span class="line">                intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.COLD_BROADCAST"</span>);  </span><br><span class="line">                sendBroadcast(intent);</span><br><span class="line">                <span class="comment">//intent.putExtra("msg", "hello coldreceiver.");  </span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> R.id.button2:&#123;<span class="comment">//发送到动态注册广播</span></span><br><span class="line">                intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.HOT_BROADCAST"</span>);  </span><br><span class="line">                <span class="comment">//intent.putExtra("msg", "hello hotreceiver.");  </span></span><br><span class="line">                sendBroadcast(intent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> R.id.button3:&#123;<span class="comment">//普通广播</span></span><br><span class="line">                intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.NORMAL_BROADCAST"</span>);  </span><br><span class="line">                sendBroadcast(intent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> R.id.button4:&#123;<span class="comment">//有序广播</span></span><br><span class="line">                intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.SORT_BROADCAST"</span>);  </span><br><span class="line">                sendOrderedBroadcast(intent, <span class="string">"scott.permission.SORT_BROADCAST_PERMISSION"</span>);  </span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, str, Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ok,将两个应用都安装到设备上，启动测试用的应用，点击第一个按钮，运行的效果如下<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/broadcast%E6%97%A5%E5%BF%971.png" alt="Broadcast静态注册日志"><br>同时，会出现”静态注册”的Toast(不方便截图)。可以看出静态注册广播能够跨应用来响应信息，这都要归功于安卓上的组件管理服务，它会读取每个应用的配置文件，然后获取里面的组件信息，每当有消息响应时，组件管理服务会从中查找有没有需要调用的组件，并判断是否进行执行。</p>
<h3 id="动态注册"><a href="#动态注册" class="headerlink" title="动态注册"></a>动态注册</h3><p>动态注册也可以分成两部分，一在代码中进行动态注册，二还是继承BroadcastReceiver，重写里面的onReceive函数。<br>我们在广播应用中新建一个HotReceiver，继承BroadcastReceiver<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String msg = intent.getStringExtra("msg");  </span></span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">2</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"动态注册"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Activity中进行动态注册<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HotReceiver receiver;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//动态注册广播</span></span><br><span class="line">        <span class="comment">//新建一个广播对象</span></span><br><span class="line">        receiver = <span class="keyword">new</span> HotReceiver();  </span><br><span class="line">        <span class="comment">//新建一个intent管理机制，（功能是对组件进行过滤，只获取需要的消息）</span></span><br><span class="line">        IntentFilter filter = <span class="keyword">new</span> IntentFilter(); </span><br><span class="line">        <span class="comment">//添加白名单（只获取该动作的信息）</span></span><br><span class="line">        filter.addAction(<span class="string">"android.intent.action.HOT_BROADCAST"</span>);          </span><br><span class="line">        <span class="comment">//与广播绑定，进行注册</span></span><br><span class="line">        registerReceiver(receiver, filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//取消注册，一定要记得，不然系统会报错误</span></span><br><span class="line">        unregisterReceiver(receiver);</span><br><span class="line">        stopService(<span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>));</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ok,再使用测试应用来检查一下效果，注意步骤，安装好广播应用打开，不要让它退出，切换到测试用的广播，点击第二个按钮。<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/broadcast%E6%97%A5%E5%BF%972.png" alt="Broadcast动态注册日志"><br>测试成功。那么我们关掉广播应用在测试一下，会发现不会再出现动态注册的打印消息。这说明动态注册的广播是与Activity绑定的，当Activity销毁时，广播也会被销毁。<br>在Android中，很多时候最好是使用动态注册的方式使用广播，比如时间变化事件，电量变更事件等，这些事件触发率太高，如果使用静态注册，会导致进程频繁的被构造和销毁从而影响整个系统的效率。</p>
<h2 id="三、广播的两种类型"><a href="#三、广播的两种类型" class="headerlink" title="三、广播的两种类型"></a>三、广播的两种类型</h2><h3 id="普通广播"><a href="#普通广播" class="headerlink" title="普通广播"></a>普通广播</h3><p>普通广播对于多个接收者来说是完全异步的，通常每个接收者都无需等待即可以接收到广播，接收者相互之间不会有影响。对于这种广播，接收者无法终止广播，即无法阻止其他接收者的接收动作。<br>接下来我们新建三个广播来进行验证。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalReceiver1</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">3</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"普通广播1"</span>);</span><br><span class="line">        abortBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalReceiver2</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">3</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"普通广播2"</span>);</span><br><span class="line">        abortBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalReceiver3</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">3</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"普通广播3"</span>);</span><br><span class="line">        abortBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".NormalReceiver1"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.NORMAL_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".NormalReceiver2"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.NORMAL_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".NormalReceiver3"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.NORMAL_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>安装完毕后，我们点击检测应用的第三个按钮，可以看到<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/broadcast_normal.png" alt="普通广播"><br><code>abortBroadcast()</code>作用是阻断广播向下一级传播，显然在这里不起作用，并会让系统报错。所以如果要让广播有一定的优先级进行传播就要使用到有序广播。</p>
<h3 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h3><p>有序广播通过调用sendOrderedBroadcast函数进行发送。它每次只发送到优先级较高的接收者那里，然后由优先级高的接受者再传播到优先级低的接收者那里，优先级高的接收者有能力终止这个广播。在有序广播的传递过程中，每个执行中的触发器组件都可以通过BroadcastReceiver.setResult等函数附加额外的数据，而下一个广播则可以使用这些数据（BroadcastReceiver.getResultData）。这样可以构成一个消息数据处理链。<br>为了保证某一事件一定会被处理，可以指明默认的广播接收器（Final Receiver）。<br>一样的，新建三个广播样例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortReceiver1</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//String msg = intent.getStringExtra("msg");  </span></span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">4</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"有序广播1"</span>);</span><br><span class="line">        abortBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortReceiver2</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//String msg = intent.getStringExtra("msg");  </span></span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">4</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"有序广播2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortReceiver3</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//String msg = intent.getStringExtra("msg");  </span></span><br><span class="line">        intent = <span class="keyword">new</span> Intent(<span class="string">"android.intent.action.BroadcastService"</span>); </span><br><span class="line">        intent.addFlags(<span class="number">4</span>);</span><br><span class="line">        context.startService(intent);</span><br><span class="line">        Log.d(<span class="string">"TEST"</span>,<span class="string">"有序广播3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".SortReceiver1"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"1000"</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.SORT_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".SortReceiver2"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"999"</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.SORT_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".SortReceiver3"</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"998"</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.SORT_BROADCAST"</span>/&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们看到，现在这三个接收者的<intent-filter>多了一个android:priority属性，并且依次减小。这个属性的范围在-1000到1000，数值越大，优先级越高。<br>同样发送广播的代码也是不一样的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendOrderedBroadcast(intent, <span class="string">"scott.permission.SORT_BROADCAST_PERMISSION"</span>);</span><br></pre></td></tr></table></figure></intent-filter></p>
<p>注意，使用<code>sendOrderedBroadcast</code>方法发送有序广播时，需要一个权限参数，如果为null则表示不要求接收者声明指定的权限，如果不为 null，则表示接收者若要接收此广播，需声明指定权限。这样做是从安全角度考虑的，例如系统的短信就是有序广播的形式，一个应用可能是具有拦截垃圾短信 的功能，当短信到来时它可以先接受到短信广播，必要时终止广播传递，这样的软件就必须声明接收短信的权限。<br>所以我们在AndroidMainfest.xml中定义一个权限，并获得权限：（是要在广播的应用中声明）<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:protectionLevel</span>=<span class="string">"normal"</span>  </span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">"scott.permission.SORT_BROADCAST_PERMISSION"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"scott.permission.SORT_BROADCAST_PERMISSION"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>（这里不是写在application内部，而是同application同级）<br>运行后只会出现这么一个消息：<br><img src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/broadcast_order.png" alt="有序广播"><br>因为在第一个广播出我们就终止了广播的继续传递，所以就只会出现这么一条打印消息。</p>
<h2 id="四、形形色色的广播"><a href="#四、形形色色的广播" class="headerlink" title="四、形形色色的广播"></a>四、形形色色的广播</h2><p><embed src="http://www.xiami.com/widget/0_3500480/singlePlayer.swf" type="application/x-shockwave-flash" width="257" height="33" wmode="transparent"><br>在android中有很多系统自带的intent.action，通过监听这些事件我们可以完成很多功能。<br><small><br>开机：<br>String BOOT_COMPLETED_ACTION 广播：在系统启动后。这个动作被广播一次（只有一次）。监听： “android.intent.action.BOOT_COMPLETED”<br>电话拨入：<br>String ANSWER_ACTION 动作：处理拨入的电话。监听： “android.intent.action.ANSWER”<br>电量变化：<br>String BATTERY_CHANGED_ACTION 广播：充电状态，或者电池的电量发生变化。监听： “android.intent.action.BATTERY_CHANGED”<br>日期改变：<br>String DATE_CHANGED_ACTION 广播：日期被改变。 监听：“android.intent.action.DATE_CHANGED”<br>取消更新下载：<br>String FOTA_CANCEL_ACTION 广播：取消所有被挂起的 (pending) 更新下载。 监听：“android.server.checkin.FOTA_CANCEL”<br>更新开始安装：<br>String FOTA_READY_ACTION 广播：更新已经被下载 可以开始安装。监听 “android.server.checkin.FOTA_READY”<br>主屏幕：<br>String HOME_CATEGORY 类别：主屏幕 (activity)。设备启动后显示的第一个 activity。 监听：”android.intent.category.HOME”<br>新应用：<br>String PACKAGE_ADDED_ACTION 广播：设备上新安装了一个应用程序包。监听： “android.intent.action.PACKAGE_ADDED”<br>删除应用：<br>String PACKAGE_REMOVED_ACTION 广播：设备上删除了一个应用程序包。监听： “android.intent.action.PACKAGE_REMOVED”<br>屏幕关闭：<br>String SCREEN_OFF_ACTION 广播：屏幕被关闭。监听： “android.intent.action.SCREEN_OFF”<br>屏幕开启：<br>String SCREEN_ON_ACTION 广播：屏幕已经被打开。 监听：“android.intent.action.SCREEN_ON”<br>时区改变：<br>String TIMEZONE_CHANGED_ACTION 广播：时区已经改变。监听： “android.intent.action.TIMEZONE_CHANGED”<br>时间改变：<br>String TIME_CHANGED_ACTION 广播：时间已经改变（重新设置）。 “android.intent.action.TIME_SET”<br>时间流逝：<br>String TIME_TICK_ACTION 广播：当前时间已经变化（正常的时间流逝）。 “android.intent.action.TIME_TICK”<br>进入大容量存储模式：<br>String UMS_CONNECTED_ACTION 广播：设备进入 USB 大容量存储模式。 “android.intent.action.UMS_CONNECTED”<br>退出大容量存储模式：<br>String UMS_DISCONNECTED_ACTION 广播：设备从 USB 大容量存储模式退出。 “android.intent.action.UMS_DISCONNECTED”<br>壁纸改变：<br>String WALLPAPER_CHANGED_ACTION 广播：系统的墙纸已经改变。 “android.intent.action.WALLPAPER_CHANGED”<br>web搜索：<br>String WEB_SEARCH_ACTION 动作：执行 web 搜索。 “android.intent.action.WEB_SEARCH”<br>网络变化：<br>String CONNECTIVITY_CHANGE_ACTION 动作：网络变化。“android.intent.action.CONNECTIVITY_CHANGE_ACTION”
</small><br>广播本身的使用很简单，它所包含的内容也很少，最多是要多记住几个系统常用的几个ACTION。但是结合广播来进行应用的开发却会给用户带来更好的体验，广播的使用会让用户觉得开发者能够为用户考虑到各个情况的发生，这点往往能够留住大多数的用户。</p>
<p>资源下载：<a href="https://github.com/cpacm/android_learn/tree/master/BroadcastDemo" target="_blank" rel="noopener">BroadcastDemo</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:348515494@qq.com">cpacm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.cpacm.net/2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/">http://www.cpacm.net/2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.cpacm.net">cpacm</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android    </a><a class="post-meta__tags" href="/tags/开发系列/">开发系列    </a></div><div class="post_share"><div class="social-share" data-image="/img/author.jpg" data-sites="facebook,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2015/03/22/Android开发日记（五）——Android数据存储（上）/"><img class="prev_cover lozad" data-src="/img/android.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Android开发日记（五）——Android数据存储（上）</span></div></a></div><div class="next-post pull-right"><a href="/2015/03/22/Mina框架的学习笔记——Android客户端的实现/"><img class="next_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/Mina%20Logo.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Mina框架的学习笔记——Android客户端的实现</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/08/10/试试 Flutter/" title="Android开发日记（二十二）—— Flutter 的第一次尝试"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/fluuter.jpg"><div class="relatedPosts_title">Android开发日记（二十二）—— Flutter 的第一次尝试</div></a></div><div class="relatedPosts_item"><a href="/2018/07/17/嵌入 ViewPager 的视频播放器/" title="Android开发日记（二十一）—— 嵌入 ViewPager 的视频播放器"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/viewpager_video.jpg"><div class="relatedPosts_title">Android开发日记（二十一）—— 嵌入 ViewPager 的视频播放器</div></a></div><div class="relatedPosts_item"><a href="/2018/02/07/Android开发日记（二十）——Android 上的调色板 Palette/" title="Android开发日记（二十）—— Android 上的调色板 Palette"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/vbox.webp"><div class="relatedPosts_title">Android开发日记（二十）—— Android 上的调色板 Palette</div></a></div><div class="relatedPosts_item"><a href="/2017/04/26/Android开发日记（十九）——说说 Android 里的 Handler 的机制/" title="Android开发日记（十九）——说说 Android 里的 Handler 的机制"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/intent.jpg"><div class="relatedPosts_title">Android开发日记（十九）——说说 Android 里的 Handler 的机制</div></a></div><div class="relatedPosts_item"><a href="/2017/03/22/Android开发日记（十八）——规范你的 Android 项目/" title="Android开发日记（十八）—— Android 项目规范"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/android.jpg"><div class="relatedPosts_title">Android开发日记（十八）—— Android 项目规范</div></a></div><div class="relatedPosts_item"><a href="/2017/03/09/Android开发日记（十七）——CoordinatorLayout 上的一些布局技巧/" title="Android开发日记（十七）—— CoordinatorLayout 上的一些布局技巧"><img class="relatedPosts_cover lozad" data-src="https://cpacmblog.oss-cn-hangzhou.aliyuncs.com/tablayout.webp"><div class="relatedPosts_title">Android开发日记（十七）—— CoordinatorLayout 上的一些布局技巧</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://www.cpacm.net/2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/';
  this.page.identifier = '2015/03/22/Android开发日记（四）——Android四大组件之Broadcast-Receiver/';
  this.page.title = 'Android开发日记（四）——Android四大组件之Broadcast Receiver';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'cpacm-net' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2019 By cpacm</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">簡</a><i class="fa fa-moon-o nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/local-search.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/js/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>